<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON Map with Color Scale</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <h2>Singapore Region Map</h2>
    <svg width="600" height="600"></svg>

    <script>
        // Load GeoJSON and CSV data
        d3.json("SGP_Region_2024.json").then(function(geojson) {
            console.log("GeoJSON loaded successfully:", geojson);

            d3.csv("region.csv").then(function(data) {
                console.log("CSV loaded successfully:", data);

                // Prepare the color scale based on the count in CSV
                const colorScale = d3.scaleLinear()
                    .domain([0, d3.max(data, d => +d.count)])
                    .range(["#f7fbff", "#08306b"]);

                // Create a map between region name and count from CSV
                const regionData = {};
                data.forEach(function(d) {
                    regionData[d.region] = +d.count;
                });

                // SVG and path setup
                const svg = d3.select("svg");
                const projection = d3.geoMercator().fitSize([600, 600], geojson);
                const path = d3.geoPath().projection(projection);

                // Draw the map
                svg.selectAll("path")
                    .data(geojson.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("fill", function(d) {
                        // Check the correct property in the GeoJSON
                        const regionName = d.properties.shape1;  // Adjust this if needed after logging
                        console.log("GeoJSON feature properties:", d.properties);

                        // Find the corresponding count in CSV
                        const value = regionData[regionName] || 0;
                        return colorScale(value);
                    })
                    .attr("stroke", "#000")
                    .attr("stroke-width", 0.5);
            }).catch(function(error) {
                console.error("Error loading CSV:", error);
            });
        }).catch(function(error) {
            console.error("Error loading GeoJSON:", error);
        });
    </script>
</body>
</html>
