<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Map Visualization</title>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <svg id="my_dataviz" width="800" height="600"></svg>

    <script>
        const svg = d3.select('my_dataviz').append('svg')
                .attr('width', 800)
                .attr('height', 600)
                .attr('viewBox', '0 0 800 600')  // Add the viewBox here
                .attr('preserveAspectRatio', 'xMidYMid meet');

        // Map and projection
        const projection = d3.geoMercator()
            .scale(3000)  // Adjust the scale
            .center([103.8198, 1.3521])
            .translate([width / 2, height / 2]);

        const path = d3.geoPath().projection(projection);

        console.log(d3.select('path').node().getBBox());
     
        function handleError(error) {
            console.error("Data load error:", error);
            alert("There was an error loading the data. Check the console for details.");
        }

        Promise.all([
            d3.json("singapore-region.geojson")
                .then((geoData) => { 
                    console.log("GeoJSON loaded successfully:", geoData); 
                    return geoData; 
                })
                .catch(handleError),
            d3.csv("region.csv")
                .then((csvData) => {
                    const data = new Map();
                    csvData.forEach(d => {
                        data.set(d.region.trim(), +d.count);
                    });
                    console.log("CSV data loaded successfully:", data);
                    return data; 
                })
        ]).then(function ([geoData, csvData]) {
            const colorScale = d3.scaleSequential(d3.interpolateBlues)
                .domain([0, d3.max(Array.from(csvData.values()))]);

            svg.selectAll("path")
                .data(geoData.features)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("fill", function (d) {
                    const regionName = d.properties.shape1; // Adjust as necessary
                    const value = csvData.get(regionName) || 0;
                    return colorScale(value);
                })
                .style("stroke", "#333")
                .style("stroke-width", "1px")
                .attr("class", "region")
                .style("opacity", 0.9);
        }).catch(function (error) {
            console.error("Error loading data:", error);
        });
    </script>
</body>
</html>
